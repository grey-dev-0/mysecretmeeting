(function(e,n,t){n(document).ready(function(){window.rtc=new e({el:"#app",data:{config:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"}]},connections:{qr_code:null,my_connection:{websocket_id:null,connection:null,stream:null,error:null}},channels:{},websocket:null},methods:{init:function(e){this.websocket=new WebSocket("wss://"+e+"/websocket");this.websocket.onopen=function(){rtc.websocket.send(JSON.stringify({action:"init",qr_code:initCode}))};this.websocket.onmessage=function(e){var n=JSON.parse(e.data);switch(n.action){case"init":rtc.connections.qr_code=n.qr_code;rtc.connections.my_connection.websocket_id=n.id;rtc.connect(n.id);rtc.call(n.peers);new t("#copy-url");break;case"sdp":rtc.connect(n.id);rtc.exchangeSdps(n.id,n.sdp);break;case"candidate":if(n.candidate!=""&&n.candidate!=null)rtc.connections[n.id].connection.addIceCandidate(new RTCIceCandidate(n.candidate));break}}},connect:function(n){var e;if(this.connections.my_connection.websocket_id==n){e=this.connections.my_connection.connection=new RTCPeerConnection(this.config);this.emitStream(e)}else{e=new RTCPeerConnection(this.config);this.connections[n]={connection:e,stream:null,error:null};e.onaddstream=function(e){rtc.connections[n].stream=e.stream;rtc.$refs["video"+n][0].srcObject=stream}}e.onicecandidate=function(e){rtc.websocket.send(JSON.stringify({action:"candidate",candidate:e.candidate}))}},emitStream:function(n){var e=function(e){rtc.connections.my_connection.stream=e;setTimeout(function(){rtc.$refs.my_video[0].srcObject=e});n.addStream(e)};var t=function(e){rtc.connections.my_connection.error=e.message};var c={audio:true,video:true};switch(true){case navigator.getUserMedia!==undefined:navigator.getUserMedia(c,e,t);break;case navigator.webkitGetUserMedia!==undefined:navigator.webkitGetUserMedia(c,e,t);break;case navigator.mediaDevices!==undefined&&navigator.mediaDevices.getUserMedia!==undefined:navigator.mediaDevices.getUserMedia(c).then(e).catch(t);break;case navigator.mozGetUserMedia!==undefined:navigator.mozGetUserMedia(c,e,function(){});break;default:alert("Could NOT access Audio / Video Input!")}},call:function(n){for(var t in n){if(rtc.connections[n[t]]===undefined)this.connect(n[t]);setTimeout(function(){rtc.connections[n[t]].connection.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true}).then(function(e){rtc.connections[n[t]].connection.setLocalDescription(e);rtc.websocket.send(JSON.stringify({action:"sdp",sdp:e}))})},1e3)}},exchangeSdps:function(e,n){var t=this.connections.my_connection.websocket_id==e?this.connections.my_connection.connection:rtc.connections[e].connection;if(n.type=="offer"){setTimeout(function(){t.setRemoteDescription(new RTCSessionDescription(n));t.createAnswer().then(function(e){t.setLocalDescription(e);rtc.websocket.send(JSON.stringify({action:"sdp",sdp:e}))})},1e3)}else this.connections[e].connection.setRemoteDescription(new RTCSessionDescription(n))}}});n("body").on("click","#upload-qr, #capture-qr",function(){n(this).next("input").trigger("click")})})})(Vue,jQuery,ClipboardJS);