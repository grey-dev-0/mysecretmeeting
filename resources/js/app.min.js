(function(){var i=new Vue({el:"#app",name:"MySecretMeeting",data:{roomId:qrCode,iceServers:iceServers,peers:[],signalingChannel:null,localStream:null,ready:false,pendingPeers:[],pendingMessages:[],createdAt:0},computed:{cells:function(){return this.peers.length+1}},methods:{setLocalPeerReady:function(){this.ready=true;for(var e in this.pendingPeers)this.peers.push(this.pendingPeers[e]);this.pendingPeers=[];setTimeout(function(){for(var e in i.pendingMessages)i.handleSignalingMessage(i.pendingMessages[e]);i.pendingMessages=[]},1e3)},initSignalingChannel:function(e){this.signalingChannel=new WebSocket(baseUrl.replace(/^https?/,"wss")+"/websocket");this.signalingChannel.onopen=function(){i.signalingChannel.send(JSON.stringify({action:"init",code:e}))};this.addSignalingListeners()},addSignalingListeners:function(){this.signalingChannel.onmessage=function(e){var n=JSON.parse(e.data);if(n.action=="init"){i.roomId=n.code;i.$nextTick(function(){if(n.local){i.createdAt=n.time;i.$refs.qr.initQrButtons()}i.initPeer(n.id,n.local,n.time)})}else if(i.ready)i.handleSignalingMessage(n);else i.pendingMessages.push(n)}},initPeer:function(e,n,i){var s={id:e,local:n,time:i};if(n||this.ready)this.peers.push(s);else this.pendingPeers.push(s)},handleSignalingMessage:function(n){switch(n.action){case"offer":this.$refs["p-"+n.senderId][0].handleOffer(n.offer,n.senderId);break;case"answer":this.$refs["p-"+n.senderId][0].handleAnswer(n.answer);break;case"candidate":this.$refs["p-"+n.senderId][0].handleCandidate(n.candidate);break;case"close":var e=_.findIndex(this.peers,function(e){return e.id==n.id});if(e!=-1)this.peers.splice(e,1)}}}})})();